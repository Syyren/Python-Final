{% extends 'index.html' %}

{% block content %}
<div id="loading">
    <p>Loading data, please wait...</p>
</div>

<div id="table-container" style="display: none;">
    <table id="titles-table">
        <thead>
            <tr>
                <th>Type</th>
                <th>Title</th>
                <th>Directors</th>
                <th>Cast</th>
                <th>Country</th>
                <th>Date Added</th>
                <th>Release Year</th>
                <th>Rating</th>
                <th>Duration</th>
                <th>Listed In</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <!-- Data will be populated here -->
        </tbody>
    </table>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Fetch the data from the API endpoint
        fetch('/get_titles/')  // Adjust the URL to match your endpoint
            .then(response => response.json())
            .then(data => {
                const tableContainer = document.getElementById('table-container');
                const loading = document.getElementById('loading');
                const tableBody = document.querySelector('#titles-table tbody');
                
                // Hide loading indicator and show the table
                loading.style.display = 'none';
                tableContainer.style.display = 'block';

                // Populate table rows with data
                data.titles.forEach(title => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${title.type}</td>
                        <td>${title.title}</td>
                        <td>${title.directors.join(', ') || 'No directors listed'}</td>
                        <td>${title.casts.join(', ') || 'No cast listed'}</td>
                        <td>${title.country}</td>
                        <td>${title.date_added}</td>
                        <td>${title.release_year}</td>
                        <td>${title.rating}</td>
                        <td>${title.duration}</td>
                        <td>${title.listed_in.join(', ') || 'No categories listed'}</td>
                        <td>${title.description}</td>
                    `;
                    tableBody.appendChild(row);
                });
            })
            .catch(error => {
                console.error('Error loading data:', error);
                document.getElementById('loading').innerHTML = '<p>Failed to load data. Please try again later.</p>';
            });
    });
</script>
{% endblock content %}
